# Environment Configuration Guide

This project uses automated environment switching with .env files and Angular environment files for seamless development and deployment workflows.

## üöÄ Quick Start - Automated Workflows

### **Development**

Navigate to the project directory and run:

```bash
npm run start
```

This command triggers the development workflow which:
- Uses `.env` for environment variables
- Serves the app with live reload at `https://localhost:4200`
- Proxies API requests to the backend

‚úÖ Auto-switches to development environment + builds

### **Production Deployment**

For a production build, run:

```bash
npm run build:prod
```

This command:
- Builds the app with `environment.prod.ts`
- Injects production environment variables from `.env`
- Outputs files to the `dist/` directory

## .env File Overview

The root `.env` file contains key-value pairs for environment variables. Here's a breakdown of commonly used variables:

```bash
# General Settings
APP_TITLE=My Angular App
APP_VERSION=1.0.0

# API Configuration
API_URL=https://api.global-webnet.com
API_KEY=your_api_key_here  # Only if required by your API

# Auth0 Configuration
AUTH0_DOMAIN=your-auth0-domain.auth0.com
AUTH0_CLIENT_ID=your-auth0-client-id
AUTH0_AUDIENCE=https://your-auth0-domain.auth0.com/api/v2/

# Development Flags
DEBUG_MODE=false
ENVIRONMENT=production
```

Remember to replace placeholder values with your actual configuration.

## Security Best Practices

- **Do not** expose sensitive data in client-side code.
- Regularly rotate API keys and credentials.
- Use HTTPS for all production interactions.
- Monitor your application for any unauthorized access or anomalies.

## Troubleshooting Tips

- **API URL Issues**: Ensure `.env` has the correct `API_URL` and that you're using the production build for testing live APIs.
- **Environment Variable Access**: If you encounter `undefined` for any env variable, ensure it's defined in the `.env` file and that your build process includes it.
- **Build Errors**: Commonly result from missing environment variables or incorrect TypeScript declarations. Double-check your `.env` and `src/types/process-env.d.ts`.

For detailed setup and troubleshooting, refer to the respective sections in this guide.

### **Manual Environment Switching**
Switch to development
npm run env:dev
Switch to production
npm run env:prod
Or use scripts directly:
Windows: switch-env.bat [dev|prod]
PowerShell: .\switch-env.ps1 -Environment [dev|prod]

## üìÅ Environment File Structure

The project uses separate environment files for each configuration:

### **Development Environment** (`.env.development`)
Auth0 Configuration
AUTH0_DOMAIN=your-tenant.region.auth0.com
AUTH0_CLIENT_ID=your-audience-url 
AUTH0_AUDIENCE=your-client-id
API Configuration - LOCAL DEVELOPMENT
API_URL=https://localhost:7280 
USE_PROXY=true
Development flags
DEBUG_MODE=true 
ENVIRONMENT=development

### **Production Environment** (`.env.production`)
Auth0 Configuration
AUTH0_DOMAIN=your-tenant.region.auth0.com
AUTH0_CLIENT_ID=your-audience-url 
AUTH0_AUDIENCE=your-client-id
API Configuration - PRODUCTION
API_URL=https://api.global-webnet.com 
USE_PROXY=false
Production flags
DEBUG_MODE=false 
ENVIRONMENT=production

### **Active Environment** (`.env`)
- Auto-generated by switching scripts
- Contains current active environment settings
- **Not committed to git** - auto-managed

## üîÑ Environment Switching

### **Automated Scripts Available:**

| Command | Description |
|---------|-------------|
| `npm run env:dev` | Switch to development environment |
| `npm run env:prod` | Switch to production environment |
| `npm run deploy:dev` | Switch to dev + build |
| `npm run deploy:prod` | Switch to prod + build |
| `npm run package:dev` | Switch to dev + build + Web Deploy package |
| `npm run package:prod` | Switch to prod + build + Web Deploy package |

Windows Batch
switch-env.bat dev     # Switch to development switch-env.bat prod    # Switch to production
PowerShell
.\switch-env.ps1 -Environment dev   # Switch to development .\switch-env.ps1 -Environment prod  # Switch to production

## üìã Setup Instructions (First Time)

### 1. Initial Environment Setup

The environment files are already configured! Just choose your workflow:
For development work
npm run deploy:dev
For production deployment
npm run package:prod

### 2. Create Angular Environment Files (if needed)
Copy development environment
cp src/environments/environment.template.ts src/environments/environment.ts
Copy production environment
cp src/environments/environment.prod.template.ts src/environments/environment.prod.ts

## üîê Security & Git

### **What's Committed to Git:**
- ‚úÖ `.env.development` - Development configuration
- ‚úÖ `.env.production` - Production configuration  
- ‚úÖ `switch-env.bat` - Windows switching script
- ‚úÖ `switch-env.ps1` - PowerShell switching script
- ‚úÖ Template files for guidance

### **What's NOT Committed:**
- ‚ùå `.env` - Active environment (auto-generated)
- ‚ùå `src/environments/environment.ts` - Active Angular environment
- ‚ùå `src/environments/environment.prod.ts` - Active Angular environment

## üèóÔ∏è Build Process Priority

1. **Environment Variables (.env)** - Highest priority
2. **Angular Environment Files** - Fallback  
3. **Default Values** - Last resort

## üîß Troubleshooting

### **Environment Issues**
Check current environment
type .env                           # Windows cat .env                           # Linux/Mac
Verify environment switching
npm run env:dev npm run env:prod

### **API URL Issues**
1. Check browser console for "WeatherService - Final API URL" message
2. Verify correct environment is active: `type .env`
3. Ensure using correct build command: `npm run deploy:prod`

### **Build Errors**
1. Switch environment first: `npm run env:prod`
2. Check that all required environment variables are defined
3. Verify TypeScript declarations in `src/types/process-env.d.ts`

### **PowerShell Execution Issues**
If PowerShell scripts are blocked
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
Or use batch file alternative
switch-env.bat prod

## üéØ Workflow Examples

### **Daily Development:**
npm run deploy:dev        # Switch to dev + build npm start                 # Start development server

### **Production Deployment:**
npm run package:prod      # Everything automated!
‚úÖ Switches to production environment
‚úÖ Builds with production optimizations
‚úÖ Creates Web Deploy package
‚úÖ Ready for deployment!

### **Testing Different Environments:**
npm run env:dev           # Switch to development npm run build             # Build with dev settings
npm run env:prod          # Switch to production
npm run build:prod        # Build with prod settings

---

**üöÄ Pro Tip:** Use `npm run package:prod` for hassle-free production deployments - it handles everything automatically!
